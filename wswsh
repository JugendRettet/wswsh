#!/usr/bin/mksh
#   Script by Ypnose  <linuxien[AT]legtux[DOT]org>

#set -x
function parse_config {
	if [[ ! -f wswsh.conf ]]; then
		print "Missing configs" >&2
		exit 1
	else
		source wswsh.conf
	fi
}

function parse_css {
	if [[ -z $CSSF ]]; then
		print ""
	fi
}

function verify_dir {
	if [[ -n $DEST && ! -d $DEST ]]; then
		print "Folder is missing" >&2
		exit 1
	elif [[ -n $DEST && -d $DEST ]]; then
		print "Using custom dir"
	fi
}

function page_content {
	PAGES="$(find -type f -iname "*.${EXT:-txt}")"
	verify_dir
	print "Generating pages..."
	#[[ ! -x $INT ]] && print "No intrepreter found" >&2 && exit 1
	for f in $PAGES; do
		#${INT:-wswshp} $f >> crappytest.html
		page_head > ${DEST:-.}/${f%.*}.html
		cat $f >> ${DEST:-.}/${f%.*}.html
		page_foot >> ${DEST:-.}/${f%.*}.html
	done
}

function page_head {
	print '<!DOCTYPE html>
<html lang="fr">
<head>
	<!--[if lt IE 9]>
	<script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<meta charset="utf-8" />
</head>
<body>'
}

function page_foot {
	print '	<!-- Proudly generated by wswsh - '"$(LC_ALL=C date)"' -->
</body>
</html>'
}

parse_config
page_content

exit
